## [前編](https://youtu.be/C0UZXqIz80c)

- デプロイのロールバックについて
  - デプロイ自動化は、ロールバックの自動化とセットになっている必要がある
    - 自動ロールバックできるなら、リリース前に手動確認は不要
      - リリース後にエラー率を監視して、一定以上エラーが出たらロールバックするなど
      - 本番環境もテストの一部と捉える
    - 戻す技術と進む技術はワンセット

- 機械は決められた動作のテストが得意で、人は意図しない動作を含むテスト(探索的)が得意
  - なので、人は探索的な動作に時間を使いたい
    - こうやったら壊れるんじゃないか？的な意地悪なテストは人間が得意

- リリースとデプロイの違い
  - リリース: 本番環境にデプロイし、お客さんに提供する
  - デプロイ: 本番環境にデプロイするだけで、お客さんには提供しない(CBT, OBTなど)

- flaky test
  - コード自体は正しいが、確率で落ちてしまうテスト
    - コードは悪くないので、原因の判別がしづらい
  - テストの失敗に鈍感になるので良くない
    - 「まあリトライして通ればいいか」的な
    - リトライを自動化してしまうのは良くない
    - 本当は一回目で落ちたらダメなテストの失敗にも気づけなくなる
  - flakyになりやすい箇所
    - テスト範囲が増えるほどflakyになる
      - E2Eがいい例
  - 対策
    - 大掛かりになるが、テストの履歴を取るという手法もある
    - テスティングフレームワークのタグ機能を利用する
      - RSpecにもあった
      - flakyなテストにflakyタグをつける
        - flakyテストが落ちるのを許容する判断ができるようになる

- 時刻のテスト
  - ランダムさは、時々未知の不具合を教えてくれる
    - property based testing
      - これによって不具合を検知できたら、開発者がその値のテストを追加して不具合を修正する
        - 未知を既知に変えられる

- レイヤごとに同じようなテストが追加されがち問題
  - APIレベルでのfeatureテストと、ドメイン層で同じアサーションを書いてしまう
  - レイヤごとに方針が決まっていないのが問題
    - どのレイヤで何をテストしておくのか決めておくのが理想
  - テストピラミッドでは、異常系のテストは基本的に下の階層(Unitテストとか)で行い、上の階層(E2Eテストとか)では正常系の割合が多くなるのが理想
